<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<!DOCTYPE html>
<html>
<head>
<title>Calendar</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.10.0/main.min.css" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.10.0/main.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.10.0/locales/ko.js"></script>
<style>
html, body {
	margin: 0;
	padding: 0;
	font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
	font-size: 14px;
}

#calendar-container {
	position: relative;
	z-index: 1;
}

#calendar {
	max-width: 1100px;
	margin: 20px auto;
}

.modal {
	position: fixed;
	width: 100%;
	/* fixedì¼ ë•ŒëŠ” height:100% ë™ì‘ */
	height: 100%;
	left: 0px;
	top: 0px;
	background-color: rgba(0, 0, 0, 0.274);
	/* ë¬´ì¡°ê±´ í¬ê²¡! */
	z-index: 314;
	display: none;
}

.detailModal {
	position: fixed;
	width: 100%;
	/* fixedì¼ ë•ŒëŠ” height:100% ë™ì‘ */
	height: 100%;
	left: 0px;
	top: 0px;
	background-color: rgba(0, 0, 0, 0.274);
	/* ë¬´ì¡°ê±´ í¬ê²¡! */
	z-index: 315;
	display: none;
}

.modalCont {
	width: 400px;
	height: 260px;
	/* ìˆ˜í‰ ê°€ìš´ë° ì •ë ¬ */
	margin-top: 15%;
	margin-left: 38%;
	padding-left: 20px;
	border-radius: 5%;
	background-color: rgb(255, 255, 255);
	color: rgb(9, 9, 8);
}

.detailModalCont {
	width: 400px;
	height: 300px;
	/* ìˆ˜í‰ ê°€ìš´ë° ì •ë ¬ */
	margin-top: 15%;
	margin-left: 38%;
	padding-left: 20px;
	border-radius: 5%;
	background-color: rgb(255, 255, 255);
	color: rgb(9, 9, 8);
}

.modalSubmit {
	margin-left: 230px;
}

.modalInput {
	width: 250px;
	height: 40px;
	font-size: 15px;
	border: 0;
	border-radius: 15px;
	outline: none;
	padding-left: 10px;
	background-color: rgb(233, 233, 233);
}

.calendarCenter {
	margin: 0 auto;
}

/* IE */
select::-ms-expand {
	display: none;
}

.select {
	width: 150px;
	height: 35px;
	background:
		url('https://freepikpsd.com/media/2019/10/down-arrow-icon-png-7-Transparent-Images.png')
		calc(100% - 5px) center no-repeat;
	background-size: 20px;
	padding: 5px 30px 5px 10px;
	border-radius: 4px;
	outline: 0 none;
}

.select option {
	background: black;
	color: #fff;
	padding: 3px 0;
}
</style>
<script src='${cPath }/resources/js/dist/index.global.js'></script>
<script src='${cPath }/resources/js/dist/ko.global.js'></script>
</head>
<body>
	<div class="myCalendarbody">

		<!-- ë‚ ì§œë¥¼ í´ë¦­í•˜ë©´ ë‚˜ì˜¤ëŠ” ëª¨ë‹¬ -->
		<div id="modal" class="modal">
			<div id="modalCont" class="modalCont">
				<br> <br> ë‹´ë‹¹ì : <input id="modalInput" class="modalInput"
					type="text" value="" placeholder="ì˜ˆì•½ë‹´ë‹¹ì"><br> <br>
				í™˜ìë²ˆí˜¸ : <select id="patientName" class="select">
					<option disabled selected>í™˜ìì´ë¦„ ğŸš‘</option>
					<option value="apple">apple</option>
					<option value="orange">orange</option>
					<option value="grape">grape</option>
					<option value="melon">melon</option>
				</select><br> <br> ì¹¨ìƒë²ˆí˜¸ : <input id="modalInput" class="modalInput"
					type="text" placeholder="ì¹¨ìƒë²ˆí˜¸"> <br> <br>
				<button id="modalSubmit" class="modalSubmit" onclick="allSave()">ë“±ë¡í•˜ê¸°</button>
				<button id="modalButton" onclick="modalClose()">X</button>
			</div>
		</div>

		<!-- ì¼ì •ì„ í´ë¦­í•˜ë©´ ë‚˜ì˜¤ëŠ” ëª¨ë‹¬ -->
		<div id="detailModal" class="detailModal">
			<div id="detailModalCont" class="detailModalCont">
				<br> ìŠ¤ì¼€ì¤„ ë²ˆí˜¸ : <input id="scheduleKey" class="modalInput"
					type="text"> <br> <br> í™˜ìëª… : <input
					id="patientName" class="modalInput" type="text"> <br>
				<br> ì¹¨ëŒ€ë²ˆí˜¸ : <input id="bedNum" class="modalInput" type="text">
				<br> <br> ë‹´ë‹¹ì : <input id="charger" class="modalInput"
					type="text"> <br> <br>
				<button class="modalSubmit" onclick="modify()">ìˆ˜ì •í•˜ê¸°</button>
				<button onclick="detailModalClose()">X</button>
			</div>
		</div>


		<div style="display: grid; grid-template-columns: 1fr;">
			<div style="display: grid; grid-template-columns: 1fr;">
				<div class="space m-3 p-5">
					<div id='calendar-container' class="calendarCenter">
						<div
							style='height: 30px; text-align: center; font-size: 50px; color: rgb(66, 75, 247); margin-bottom: 30px; font-weight: bolder;'>
							ì˜ˆì•½ì¼ì •</div>
						<div id='calendar'></div>
						<!-- ìº˜ë¦°ë”ê°€ ìƒì„±ë˜ëŠ” ê³³-->
					</div>
				</div>
			</div>
		</div>
	</div>
		<script>
            let calendar = null;

            $(function () {
                const Calendar = FullCalendar.Calendar; // ìº˜ë¦°ë” api ìƒì„±í•˜ê¸°

                const calendarEl = document.querySelector('#calendar'); // bodyì— ìº˜ë¦°ë” ë„£ì„ ë¶€ë¶„ íƒœê·¸ì„ íƒ

                calendar = new Calendar(calendarEl, {
                    selectable: true,
                    selectHelper: true,
                    select: function (res) {
                        modal.show()
                    },
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay'
                    },
                    events: '${cPath}/calevents',  // url ì„œë¸”ë¦¿ ì£¼ì†Œ ì¨ì£¼ë©´ ë¨!

                    editable: true, // í¸ì§‘ê°€ëŠ¥

                    locale: 'ko', // í•œêµ­ì–´
                    eventDrop: function (info) {    // ë“œë˜ê·¸í•´ì„œ ìœ„ì¹˜ ì§€ì •í•˜ë©´ ë‚ ì§œ ìˆ˜ì •
                        let id = info.event.id;
                        let title = info.event.title;
                        let start = info.event.start.toISOString().substr(0, 10);
                        $.ajax({
                            url: "",
                            type: "post",
                            data: { id: id, title: title, start: start },
                            success: function () {
                                alert("ì¼ì •ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ")
                            }
                        })
                    },
                    // ì¼ì • í´ë¦­í•˜ë©´ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ë¡œ ë³´ì—¬ì£¼ê¸°
                    eventClick: function (info) {
                        console.log(info.event.title)
                        $("#scheduleKey").val(info.event.id);
                        $("#patientName").val(info.event.title);
                        $("#bedNum").val(info.event.extendedProps.bed)
                        $("#charger").val(info.event.extendedProps.charger)
                        /*
                        $.ajax({
                            url: "",
                            type: "post",
                            data: {
                                id: id
                            },
                            success: function (res) {
                            }
                        })
                        */
                        detailModal.show();
                    }

                });
                calendar.render();
            });

            const modal = $('#modal')
            const modalClose = () => {
                modal.hide();
            }
            const detailModal = $('.detailModal')
            const detailModalClose = () => {
                detailModal.hide();
            }


            // ëª¨ë‹¬ì°½ì—ì„œ ì¼ì • ìˆ˜ì •í•˜ê¸°
            const modify = () => {
                let scheduleId = $("#scheduleKey").val();
                let bedNum = $("#bedNum").val();
                let charger = $("#charger").val();
                let sendData = {}
                sendData = {
                    "scheduleKey": scheduleId, "wardBedKey": bedNum, "appintmentCharger": charger
                }
                $.ajax({
                    url: "${cPath}/scheduleUpdate",
                    type: "post",
                    data: JSON.stringify(sendData),
                    contentType: "application/json",
                    success: function (res) {
                        calendar.refetchEvents();
                        calendar.render();
                        detailModal.hide();
                    },
                    error: function (request, status, error) {
                        alert("ìƒíƒœì½”ë“œ:" + request.status + "\n" + "ì—ëŸ¬ë‚´ìš©:" + request.responseText + "\n" + "error:" + error);
                    }
                })
            }



            // ëª¨ë‹¬ì°½ì—ì„œ ì‚­ì œ ëˆŒë €ì„ ë•Œ ì•„ì§ ì•ˆë§Œë“¦
            const deleteEvent = (id) => {
                $.ajax({
                    url: "",
                    type: "post",
                    data: {
                        id: id
                    },
                    success: function (res) {
                        alert("ì„±ê³µ ì‚­ì œ")
                    },
                    error: function (request, status, error) {
                        alert("ìƒíƒœì½”ë“œ:" + request.status + "\n" + "ì—ëŸ¬ë‚´ìš©:" + request.responseText + "\n" + "error:" + error);
                    }
                })
            }

            const createOption = () => {
                // ì˜¤ë”ëª©ë¡ì— ì´ë¦„ì´ ìˆëŠ” í™˜ì ê°€ì ¸ì˜¤ê¸°
                $.ajax({
                    url: "",
                    type: "get",
                    dataType: "json",
                    success: function (res) {
                    },
                    error: function (request, status, error) {
                        alert("ìƒíƒœì½”ë“œ:" + request.status + "\n" + "ì—ëŸ¬ë‚´ìš©:" + request.responseText + "\n" + "error:" + error);
                    }
                })
            }
        </script>
</body>
</html>
